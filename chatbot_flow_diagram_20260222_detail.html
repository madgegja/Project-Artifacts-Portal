<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOOMICS CS AI 챗봇 파이프라인 플로우 다이어그램</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F8FAFC;
            color: #1E293B;
            min-height: 100vh;
            padding: 32px 16px;
            line-height: 1.7;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ===== HEADER ===== */
        .header {
            text-align: center;
            margin-bottom: 48px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.15);
        }
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        .header .subtitle {
            color: #64748B;
            font-size: 15px;
            margin-bottom: 12px;
        }
        .header .meta {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
        }
        .header .badge {
            display: inline-block;
            background: rgba(96, 165, 250, 0.12);
            border: 1px solid rgba(96, 165, 250, 0.25);
            color: #1d4ed8;
            padding: 4px 14px;
            border-radius: 20px;
            font-size: 12px;
        }

        /* ===== FLOW SECTION ===== */
        .flow-section {
            margin-bottom: 48px;
        }
        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 24px;
            padding-left: 12px;
            border-left: 3px solid #60a5fa;
        }

        /* ===== FLOW NODES ===== */
        .flow-center {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .node {
            border-radius: 12px;
            padding: 18px 28px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            cursor: default;
            max-width: 600px;
            width: 100%;
        }
        .node:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }
        .node .step-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
            opacity: 0.7;
        }
        .node .title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }
        .node .desc {
            font-size: 13px;
            opacity: 0.85;
            line-height: 1.5;
        }
        .node .file-ref {
            font-size: 12px;
            opacity: 0.7;
            font-family: 'Consolas', 'Courier New', monospace;
            margin-top: 6px;
        }

        /* Node colors */
        .node-blue {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.08));
            border: 1.5px solid rgba(59, 130, 246, 0.4);
            color: #bfdbfe;
        }
        .node-purple {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.08));
            border: 1.5px solid rgba(139, 92, 246, 0.4);
            color: #6d28d9;
        }
        .node-red {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.08));
            border: 1.5px solid rgba(239, 68, 68, 0.4);
            color: #b91c1c;
        }
        .node-orange {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.08));
            border: 1.5px solid rgba(245, 158, 11, 0.4);
            color: #92400e;
        }
        .node-green {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.08));
            border: 1.5px solid rgba(16, 185, 129, 0.4);
            color: #a7f3d0;
        }
        .node-cyan {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(6, 182, 212, 0.08));
            border: 1.5px solid rgba(6, 182, 212, 0.4);
            color: #a5f3fc;
        }
        .node-gray {
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.2), rgba(100, 116, 139, 0.08));
            border: 1.5px solid rgba(100, 116, 139, 0.4);
            color: #475569;
        }

        /* ===== DIAMOND (Decision) ===== */
        .diamond-wrapper {
            display: flex;
            justify-content: center;
            padding: 8px 0;
        }
        .diamond {
            width: 220px;
            height: 100px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .diamond::before {
            content: '';
            position: absolute;
            width: 160px;
            height: 80px;
            background: rgba(251, 191, 36, 0.12);
            border: 1.5px solid rgba(251, 191, 36, 0.4);
            transform: rotate(45deg);
            border-radius: 6px;
        }
        .diamond .diamond-text {
            position: relative;
            z-index: 1;
            font-size: 12px;
            font-weight: 600;
            color: #b45309;
        }

        /* ===== ARROWS ===== */
        .arrow-down {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px 0;
        }
        .arrow-down .arrow-line {
            width: 2px;
            height: 28px;
            background: linear-gradient(to bottom, rgba(148, 163, 184, 0.5), rgba(148, 163, 184, 0.2));
        }
        .arrow-down .arrow-head {
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 8px solid rgba(148, 163, 184, 0.5);
        }
        .arrow-down .arrow-label {
            font-size: 12px;
            color: #64748B;
            margin-top: 2px;
        }

        .arrow-down-colored .arrow-line { height: 20px; }

        .arrow-line-blue { background: linear-gradient(to bottom, rgba(59, 130, 246, 0.6), rgba(59, 130, 246, 0.2)) !important; }
        .arrow-head-blue { border-top-color: rgba(59, 130, 246, 0.6) !important; }
        .arrow-line-red { background: linear-gradient(to bottom, rgba(239, 68, 68, 0.6), rgba(239, 68, 68, 0.2)) !important; }
        .arrow-head-red { border-top-color: rgba(239, 68, 68, 0.6) !important; }
        .arrow-line-orange { background: linear-gradient(to bottom, rgba(245, 158, 11, 0.6), rgba(245, 158, 11, 0.2)) !important; }
        .arrow-head-orange { border-top-color: rgba(245, 158, 11, 0.6) !important; }
        .arrow-line-green { background: linear-gradient(to bottom, rgba(16, 185, 129, 0.6), rgba(16, 185, 129, 0.2)) !important; }
        .arrow-head-green { border-top-color: rgba(16, 185, 129, 0.6) !important; }
        .arrow-line-purple { background: linear-gradient(to bottom, rgba(139, 92, 246, 0.6), rgba(139, 92, 246, 0.2)) !important; }
        .arrow-head-purple { border-top-color: rgba(139, 92, 246, 0.6) !important; }

        /* ===== DECISION BRANCHES ===== */
        .branch-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            width: 100%;
        }
        .branch-item {
            flex: 1;
            min-width: 180px;
            max-width: 260px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .branch-label {
            font-size: 12px;
            font-weight: 600;
            padding: 3px 10px;
            border-radius: 10px;
            margin-bottom: 8px;
        }
        .branch-label-green { background: rgba(16, 185, 129, 0.2); color: #047857; border: 1px solid rgba(16, 185, 129, 0.3); }
        .branch-label-red { background: rgba(239, 68, 68, 0.2); color: #b91c1c; border: 1px solid rgba(239, 68, 68, 0.3); }
        .branch-label-blue { background: rgba(59, 130, 246, 0.2); color: #1d4ed8; border: 1px solid rgba(59, 130, 246, 0.3); }

        /* ===== PARALLEL BOX ===== */
        .parallel-container {
            display: flex;
            justify-content: center;
            gap: 24px;
            width: 100%;
            max-width: 800px;
            flex-wrap: wrap;
        }
        .parallel-branch {
            flex: 1;
            min-width: 300px;
            max-width: 380px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .parallel-header {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64748B;
            margin-bottom: 8px;
        }
        .parallel-wrapper {
            position: relative;
            width: 100%;
            max-width: 820px;
            padding: 16px;
            border: 1px dashed rgba(148, 163, 184, 0.2);
            border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            background: rgba(15, 23, 42, 0.5);
        }
        .parallel-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #FFFFFF;
            padding: 2px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            color: #64748B;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        /* ===== THREE-WAY SPLIT ===== */
        .three-way {
            display: flex;
            justify-content: center;
            gap: 16px;
            width: 100%;
            flex-wrap: wrap;
        }
        .three-way .path {
            flex: 1;
            min-width: 280px;
            max-width: 370px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .three-way .path .node {
            width: 100%;
            max-width: 370px;
        }

        /* ===== DECISION TREE ===== */
        .decision-tree {
            width: 100%;
            max-width: 900px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        .decision-row {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 4px;
            border-radius: 8px;
            font-size: 13px;
            transition: background 0.2s;
        }
        .decision-row:hover {
            background: rgba(148, 163, 184, 0.06);
        }
        .decision-condition {
            flex: 1;
            color: #475569;
        }
        .decision-condition code {
            background: rgba(148, 163, 184, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            color: #1E293B;
        }
        .decision-arrow {
            margin: 0 12px;
            color: #475569;
            font-size: 14px;
        }
        .decision-result {
            min-width: 60px;
            text-align: center;
            font-weight: 700;
            font-size: 12px;
            padding: 3px 12px;
            border-radius: 6px;
        }
        .result-l1 { background: rgba(239, 68, 68, 0.2); color: #b91c1c; border: 1px solid rgba(239, 68, 68, 0.3); }
        .result-l2 { background: rgba(245, 158, 11, 0.2); color: #b45309; border: 1px solid rgba(245, 158, 11, 0.3); }
        .result-l3 { background: rgba(16, 185, 129, 0.2); color: #047857; border: 1px solid rgba(16, 185, 129, 0.3); }

        /* ===== OUTPUT DETAIL LIST ===== */
        .output-list {
            list-style: none;
            text-align: left;
            margin-top: 8px;
            padding: 0;
        }
        .output-list li {
            font-size: 12px;
            padding: 3px 0;
            opacity: 0.85;
            position: relative;
            padding-left: 14px;
        }
        .output-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 10px;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.7;
        }

        /* ===== SUB-DIAGRAM: FRAUD SCORING ===== */
        .sub-diagram {
            margin-top: 48px;
            padding: 24px;
            background: rgba(30, 41, 59, 0.4);
            border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        .sub-diagram-title {
            font-size: 17px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .fraud-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }
        .fraud-column-title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .fraud-tag {
            display: inline-block;
            font-size: 12px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
        }
        .fraud-tag-critical { background: rgba(239, 68, 68, 0.25); color: #b91c1c; }
        .fraud-tag-supporting { background: rgba(245, 158, 11, 0.25); color: #b45309; }

        .fraud-item {
            display: flex;
            align-items: center;
            padding: 6px 10px;
            margin-bottom: 4px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 6px;
            font-size: 12px;
            transition: background 0.2s;
        }
        .fraud-item:hover {
            background: rgba(30, 41, 59, 0.8);
        }
        .fraud-item .flag-id {
            font-weight: 700;
            min-width: 28px;
            color: #64748B;
            font-family: 'Consolas', monospace;
        }
        .fraud-item .flag-name {
            flex: 1;
            color: #475569;
        }
        .fraud-item .flag-score {
            font-weight: 700;
            font-family: 'Consolas', monospace;
            min-width: 40px;
            text-align: right;
        }
        .fraud-item .flag-score-critical { color: #b91c1c; }
        .fraud-item .flag-score-supporting { color: #b45309; }

        /* Score bar */
        .score-bar-container {
            margin-top: 16px;
        }
        .score-bar-label {
            font-size: 12px;
            color: #64748B;
            margin-bottom: 6px;
        }
        .score-bar {
            height: 28px;
            border-radius: 8px;
            display: flex;
            overflow: hidden;
            position: relative;
        }
        .score-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            position: relative;
        }
        .score-low {
            flex: 30;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(16, 185, 129, 0.15));
            color: #047857;
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px 0 0 8px;
        }
        .score-medium {
            flex: 20;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(245, 158, 11, 0.15));
            color: #92400e;
            border-top: 1px solid rgba(245, 158, 11, 0.3);
            border-bottom: 1px solid rgba(245, 158, 11, 0.3);
        }
        .score-high {
            flex: 50;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(239, 68, 68, 0.15));
            color: #b91c1c;
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 0 8px 8px 0;
        }
        .score-tick {
            position: absolute;
            top: -16px;
            font-size: 12px;
            color: #64748B;
        }

        /* ===== L3 GRID ===== */
        .l3-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            margin-top: 12px;
        }
        .l3-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(16, 185, 129, 0.06);
            border: 1px solid rgba(16, 185, 129, 0.15);
            border-radius: 8px;
            font-size: 12px;
            color: #a7f3d0;
            transition: all 0.2s;
        }
        .l3-item:hover {
            background: rgba(16, 185, 129, 0.12);
            border-color: rgba(16, 185, 129, 0.3);
        }
        .l3-item .l3-cat {
            font-size: 12px;
            font-weight: 600;
            padding: 1px 6px;
            border-radius: 4px;
            min-width: 20px;
            text-align: center;
        }
        .l3-cat-sub { background: rgba(59, 130, 246, 0.25); color: #1d4ed8; }
        .l3-cat-ref { background: rgba(245, 158, 11, 0.25); color: #92400e; }
        .l3-cat-acc { background: rgba(139, 92, 246, 0.25); color: #6d28d9; }
        .l3-cat-pay { background: rgba(6, 182, 212, 0.25); color: #a5f3fc; }
        .l3-cat-tech { background: rgba(100, 116, 139, 0.25); color: #475569; }

        /* ===== LEGEND ===== */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 16px 20px;
            background: rgba(30, 41, 59, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            margin-top: 48px;
        }
        .legend-title {
            width: 100%;
            font-size: 14px;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 4px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #64748B;
        }
        .legend-swatch {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        .legend-diamond {
            width: 12px;
            height: 12px;
            transform: rotate(45deg);
            border-radius: 2px;
        }
        .swatch-blue { background: rgba(59, 130, 246, 0.5); border: 1px solid rgba(59, 130, 246, 0.6); }
        .swatch-red { background: rgba(239, 68, 68, 0.5); border: 1px solid rgba(239, 68, 68, 0.6); }
        .swatch-orange { background: rgba(245, 158, 11, 0.5); border: 1px solid rgba(245, 158, 11, 0.6); }
        .swatch-green { background: rgba(16, 185, 129, 0.5); border: 1px solid rgba(16, 185, 129, 0.6); }
        .swatch-purple { background: rgba(139, 92, 246, 0.5); border: 1px solid rgba(139, 92, 246, 0.6); }
        .swatch-cyan { background: rgba(6, 182, 212, 0.5); border: 1px solid rgba(6, 182, 212, 0.6); }
        .swatch-diamond { background: rgba(251, 191, 36, 0.5); border: 1px solid rgba(251, 191, 36, 0.6); }

        /* ===== MERGE INDICATOR ===== */
        .merge-bar {
            width: 80%;
            max-width: 700px;
            height: 2px;
            background: linear-gradient(90deg,
                rgba(239, 68, 68, 0.4),
                rgba(245, 158, 11, 0.4),
                rgba(16, 185, 129, 0.4)
            );
            margin: 0 auto;
            border-radius: 1px;
        }

        /* ===== CONVERGENCE LINES ===== */
        .converge-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .converge-lines {
            width: 80%;
            max-width: 700px;
            height: 24px;
            position: relative;
        }
        .converge-lines::before {
            content: '';
            position: absolute;
            top: 0;
            left: 10%;
            right: 10%;
            height: 1px;
            background: linear-gradient(90deg,
                rgba(239, 68, 68, 0.3),
                rgba(245, 158, 11, 0.3) 50%,
                rgba(16, 185, 129, 0.3)
            );
        }
        .converge-lines::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 2px;
            height: 100%;
            background: rgba(148, 163, 184, 0.3);
            transform: translateX(-50%);
        }

        /* ===== FOOTER ===== */
        .footer {
            text-align: center;
            margin-top: 48px;
            padding-top: 24px;
            border-top: 1px solid rgba(148, 163, 184, 0.1);
            color: #475569;
            font-size: 12px;
        }

        /* ===== PRINT ===== */
        @media print {
            body {
                background: #F8FAFC;
                color: #1E293B;
                padding: 16px;
            }
            .header h1 {
                background: none;
                -webkit-text-fill-color: #1e3a5f;
                color: #1e3a5f;
            }
            .header .subtitle, .header .badge { color: #475569; }
            .node { border-width: 2px; }
            .node-blue { background: #eff6ff; border-color: #3b82f6; color: #1e40af; }
            .node-purple { background: #f5f3ff; border-color: #8b5cf6; color: #5b21b6; }
            .node-red { background: #fef2f2; border-color: #ef4444; color: #991b1b; }
            .node-orange { background: #fffbeb; border-color: #92400e; color: #92400e; }
            .node-green { background: #ecfdf5; border-color: #10b981; color: #065f46; }
            .node-cyan { background: #ecfeff; border-color: #06b6d4; color: #155e75; }
            .node-gray { background: #F8FAFC; border-color: #64748B; color: #334155; }
            .sub-diagram, .parallel-wrapper { background: #F8FAFC; border-color: #1E293B; }
            .decision-tree { background: #F8FAFC; border-color: #1E293B; }
            .legend { background: #F8FAFC; border-color: #1E293B; }
            .footer { color: #64748B; border-color: #1E293B; }
            .arrow-down .arrow-line { background: #64748B !important; }
            .arrow-down .arrow-head { border-top-color: #64748B !important; }
            .fraud-item { background: #1E293B; }
            .l3-item { background: #ecfdf5; border-color: #10b981; color: #065f46; }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .fraud-grid { grid-template-columns: 1fr; }
            .three-way { flex-direction: column; align-items: center; }
            .three-way .path { max-width: 100%; }
            .parallel-container { flex-direction: column; align-items: center; }
            .parallel-branch { max-width: 100%; }
            .header h1 { font-size: 22px; }
        }
    </style>
</head>
<body>

<div class="container">

    <!-- ===== HEADER ===== -->
    <div class="header">
        <h1>TOOMICS CS AI 챗봇 파이프라인 플로우 다이어그램</h1>
        <div class="subtitle">고객 메시지 입력 &rarr; 최종 응답까지의 전체 처리 흐름</div>
        <div class="meta">
            <span class="badge">작성자: 유종선</span>
            <span class="badge">작성일: 2026-02-22</span>
            <span class="badge">Phase 2 &mdash; 프로토타입 서버</span>
            <span class="badge">월 ~1,660건 처리 기준</span>
        </div>
    </div>

    <!-- ===== MAIN FLOW ===== -->
    <div class="flow-section">
        <div class="section-title">메인 파이프라인 흐름</div>

        <div class="flow-center">

            <!-- STEP 0: 고객 메시지 입력 -->
            <div class="node node-blue" style="max-width: 500px;">
                <div class="step-label">Step 0</div>
                <div class="title">고객 메시지 입력</div>
                <div class="desc">웹사이트/앱에서 CS AI 챗봇으로 메시지 전송<br>ChatRequest { message, session_id, customer_email }</div>
                <div class="file-ref">POST /api/chat &rarr; app/routers/chat.py</div>
            </div>

            <div class="arrow-down">
                <div class="arrow-line"></div>
                <div class="arrow-head"></div>
            </div>

            <!-- STEP 0.5: 세션 로드 -->
            <div class="node node-gray" style="max-width: 500px;">
                <div class="step-label">Step 0.5</div>
                <div class="title">세션 로드/생성</div>
                <div class="desc">SessionManager에서 기존 세션 로드 또는 신규 생성<br>대화 이력, 누적 Fraud 점수, 감지된 언어 복원</div>
                <div class="file-ref">app/services/session_manager.py</div>
            </div>

            <div class="arrow-down">
                <div class="arrow-line"></div>
                <div class="arrow-head"></div>
            </div>

            <!-- STEP 1: 언어 감지 -->
            <div class="node node-cyan" style="max-width: 560px;">
                <div class="step-label">Step 1</div>
                <div class="title">언어 감지</div>
                <div class="desc">고객 메시지에서 언어 자동 감지 (세션에 저장된 언어 우선 재사용)<br>LanguageResult { language, confidence, market, phase }</div>
                <div class="file-ref">app/services/multilingual.py</div>
            </div>

            <div class="arrow-down">
                <div class="arrow-line"></div>
                <div class="arrow-head"></div>
            </div>

            <!-- DECISION: Phase 1 vs Phase 2 -->
            <div class="diamond-wrapper">
                <div class="diamond">
                    <div class="diamond-text">언어 Phase<br>판별</div>
                </div>
            </div>

            <!-- Branch labels -->
            <div class="branch-container" style="margin: 12px 0;">
                <div class="branch-item">
                    <div class="branch-label branch-label-green">Phase 1 언어</div>
                    <div style="font-size: 12px; color: #64748B; text-align: center;">EN / FR / ES / PT / DE<br>(상위 5개 마켓, 84%)</div>
                    <div class="arrow-down" style="padding: 4px 0;">
                        <div class="arrow-line arrow-line-green" style="height: 16px;"></div>
                        <div class="arrow-head arrow-head-green"></div>
                    </div>
                    <div style="font-size: 12px; color: #047857; font-weight: 600;">계속 진행 &darr;</div>
                </div>
                <div class="branch-item">
                    <div class="branch-label branch-label-blue">Phase 2 언어</div>
                    <div style="font-size: 12px; color: #64748B; text-align: center;">TH / JP / CN / IT / KR<br>(Phase 3에서 지원 예정)</div>
                    <div class="arrow-down" style="padding: 4px 0;">
                        <div class="arrow-line arrow-line-blue" style="height: 16px;"></div>
                        <div class="arrow-head arrow-head-blue"></div>
                    </div>
                    <div class="node node-orange" style="padding: 10px 16px; max-width: 240px;">
                        <div class="title" style="font-size: 13px;">인사말 + L1 에스컬레이션</div>
                        <div class="desc" style="font-size: 12px;">해당 언어 인사말 제공 후<br>상담원 연결 안내 (종료)</div>
                    </div>
                </div>
                <div class="branch-item">
                    <div class="branch-label branch-label-red">미지원 언어</div>
                    <div style="font-size: 12px; color: #64748B; text-align: center;">감지 실패 또는<br>미지원 언어</div>
                    <div class="arrow-down" style="padding: 4px 0;">
                        <div class="arrow-line arrow-line-red" style="height: 16px;"></div>
                        <div class="arrow-head arrow-head-red"></div>
                    </div>
                    <div style="font-size: 12px; color: #b91c1c; font-weight: 600;">English fallback</div>
                </div>
            </div>

            <div class="arrow-down" style="margin-top: 16px;">
                <div class="arrow-line" style="height: 20px;"></div>
                <div class="arrow-head"></div>
                <div class="arrow-label">Phase 1 언어 확인됨</div>
            </div>

            <!-- STEP 1.5: 결제 정보 수집 체크 -->
            <div class="node node-gray" style="max-width: 560px;">
                <div class="step-label">Step 1.5 (조건부)</div>
                <div class="title">계정 식별 체크</div>
                <div class="desc">
                    Subscription / Refund / Payment 카테고리 최초 감지 시<br>
                    <strong>결제 정보 요청</strong> (최근 결제일, 금액, 끝 4자리, 등록 이메일)<br>
                    전체 CS 답변의 ~45%가 이 패턴 &mdash; 계정 교차 참조 필수
                </div>
                <div class="file-ref">pipeline.py &rarr; PAYMENT_INFO_MESSAGES</div>
            </div>

            <div class="arrow-down">
                <div class="arrow-line"></div>
                <div class="arrow-head"></div>
            </div>

            <!-- STEP 2: PARALLEL -->
            <div class="parallel-wrapper">
                <div class="parallel-badge">Step 2 &mdash; 병렬 처리 (asyncio.gather)</div>
                <div class="parallel-container" style="margin-top: 8px;">

                    <!-- LEFT: Fraud Detection -->
                    <div class="parallel-branch">
                        <div class="parallel-header">좌측 분기</div>
                        <div class="node node-purple" style="max-width: 100%;">
                            <div class="step-label">Step 2A</div>
                            <div class="title">Fraud 탐지</div>
                            <div class="desc">
                                9개 Red Flag 지표 실시간 체크<br>
                                스코어 산출 (0~100)<br>
                                누적 세션 점수 반영
                            </div>
                            <ul class="output-list">
                                <li>FraudResult { score, risk_level }</li>
                                <li>flags[] &mdash; 감지된 지표 목록</li>
                                <li>needs_verification 플래그</li>
                            </ul>
                            <div class="file-ref">app/services/fraud_detector.py</div>
                        </div>
                    </div>

                    <!-- RIGHT: Intent Classification -->
                    <div class="parallel-branch">
                        <div class="parallel-header">우측 분기</div>
                        <div class="node node-blue" style="max-width: 100%;">
                            <div class="step-label">Step 2B</div>
                            <div class="title">의도 분류</div>
                            <div class="desc">
                                7 카테고리 &times; 23 Sub-Intent 분류<br>
                                Confidence 점수 산출<br>
                                복합 의도 감지
                            </div>
                            <ul class="output-list">
                                <li>IntentResult { category, sub_intent }</li>
                                <li>confidence (0.0 ~ 1.0)</li>
                                <li>alternative_intents[]</li>
                            </ul>
                            <div class="file-ref">app/services/intent_classifier.py</div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="arrow-down">
                <div class="arrow-line"></div>
                <div class="arrow-head"></div>
                <div class="arrow-label">두 결과 병합</div>
            </div>

            <!-- STEP 3: ESCALATION DECISION -->
            <div class="node node-cyan" style="max-width: 920px; padding: 14px 20px;">
                <div class="step-label">Step 3</div>
                <div class="title">에스컬레이션 판단</div>
                <div class="desc" style="margin-bottom: 12px;">Fraud 결과 + Intent 결과를 종합하여 L1 / L2 / L3 라우팅 결정</div>
                <div class="file-ref" style="margin-bottom: 8px;">app/services/pipeline.py &rarr; _determine_escalation_level()</div>
            </div>

            <!-- Decision Tree -->
            <div class="decision-tree" style="margin-top: 8px;">
                <div style="font-size: 13px; font-weight: 700; color: #64748B; margin-bottom: 10px; text-align: center;">우선순위 기반 판단 (L1 &gt; L2 &gt; L3)</div>

                <div class="decision-row">
                    <div class="decision-condition">Fraud 점수 <code>HIGH (&ge;50)</code></div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l1">강제 L1</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">의도 분류 불가 <code>confidence &lt; 0.50</code></div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l1">L1</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">카테고리 <code>Content</code> 또는 <code>Other</code></div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l1">L1</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">L1 Sub-Intent: <code>unauthorized_charge</code> <code>child_purchase</code> <code>double_charge</code> <code>account_locked</code> <code>bug_report</code></div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l1">L1</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">법적/차지백 키워드 감지 (lawyer, GDPR, chargeback...)</div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l1">L1</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">욕설, 위협, 극단적 감정 표현</div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l1">L1</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">기기명+OS 포함 상세 버그 리포트 패턴</div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l1">L1</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">복합 의도 3개 이상</div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l1">L1</div>
                </div>

                <div style="height: 1px; background: rgba(148,163,184,0.1); margin: 8px 0;"></div>

                <div class="decision-row">
                    <div class="decision-condition">L2 Sub-Intent: <code>simple_refund</code> <code>cancel_and_refund</code> <code>auto_renewal_complaint</code> <code>partial_refund</code></div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l2">L2</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">L2 Sub-Intent: <code>social_login_issue</code> <code>email_change</code> <code>payment_not_applied</code> <code>coin_issue</code></div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l2">L2</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">동일 이슈 2회 이상 반복 접수</div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l2">L2</div>
                </div>
                <div class="decision-row">
                    <div class="decision-condition">의도 저신뢰도 <code>confidence &lt; 0.70</code> (L1 트리거 없음)</div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l2">L2</div>
                </div>

                <div style="height: 1px; background: rgba(148,163,184,0.1); margin: 8px 0;"></div>

                <div class="decision-row">
                    <div class="decision-condition">위 조건 모두 해당 없음 + <code>confidence &ge; 0.70</code> + 셀프서비스 플로우 존재</div>
                    <div class="decision-arrow">&rarr;</div>
                    <div class="decision-result result-l3">L3</div>
                </div>
            </div>

            <div class="arrow-down" style="margin-top: 16px;">
                <div class="arrow-line" style="height: 20px;"></div>
                <div class="arrow-head"></div>
                <div class="arrow-label">3개 경로로 분기</div>
            </div>

            <!-- STEP 4: THREE-WAY ROUTING -->
            <div class="three-way">

                <!-- L1 Path -->
                <div class="path">
                    <div class="arrow-down arrow-down-colored">
                        <div class="arrow-line arrow-line-red"></div>
                        <div class="arrow-head arrow-head-red"></div>
                    </div>
                    <div class="node node-red">
                        <div class="step-label">Step 4A</div>
                        <div class="title">L1 &mdash; 즉시 에스컬레이션</div>
                        <div class="desc" style="text-align: left;">
                            AI 자동 응답 없음 (절대 금지)<br>
                            상담원 즉시 연결
                        </div>
                        <ul class="output-list">
                            <li>Zendesk 티켓 생성 (urgent/high)</li>
                            <li>맥락 요약 (ContextSummary) 전달</li>
                            <li>Fraud flags 첨부 (해당 시)</li>
                            <li>"상담원이 곧 연락드리겠습니다"</li>
                        </ul>
                        <div class="file-ref">app/services/escalation_handler.py</div>
                    </div>
                    <div style="text-align: center; margin-top: 8px;">
                        <span style="font-size: 12px; color: #b91c1c; font-weight: 600;">월 ~1,030건 중 일부 (62%)</span>
                    </div>
                </div>

                <!-- L2 Path -->
                <div class="path">
                    <div class="arrow-down arrow-down-colored">
                        <div class="arrow-line arrow-line-orange"></div>
                        <div class="arrow-head arrow-head-orange"></div>
                    </div>
                    <div class="node node-orange">
                        <div class="step-label">Step 4B</div>
                        <div class="title">L2 &mdash; AI 초안 + 상담원 검토</div>
                        <div class="desc" style="text-align: left;">
                            AI가 응답 초안 생성<br>
                            상담원이 검토/수정 후 발송
                        </div>
                        <ul class="output-list">
                            <li>RAG 검색 (ChromaDB 벡터)</li>
                            <li>매뉴얼 기반 AI 초안 생성</li>
                            <li>추가 문의 정보 수집 안내</li>
                            <li>Zendesk 티켓 생성 (normal)</li>
                            <li>"추가 지원이 필요하시면 알려주세요"</li>
                        </ul>
                        <div class="file-ref">app/services/self_service.py (L2 모드)</div>
                    </div>
                    <div style="text-align: center; margin-top: 8px;">
                        <span style="font-size: 12px; color: #b45309; font-weight: 600;">월 ~1,030건 중 일부 (62%)</span>
                    </div>
                </div>

                <!-- L3 Path -->
                <div class="path">
                    <div class="arrow-down arrow-down-colored">
                        <div class="arrow-line arrow-line-green"></div>
                        <div class="arrow-head arrow-head-green"></div>
                    </div>
                    <div class="node node-green">
                        <div class="step-label">Step 4C</div>
                        <div class="title">L3 &mdash; 셀프서비스 자동 처리</div>
                        <div class="desc" style="text-align: left;">
                            검증된 셀프서비스 안내 자동 발송<br>
                            티켓 제출 옵션 항상 포함
                        </div>
                        <ul class="output-list">
                            <li>RAG 검색 (ChromaDB 벡터)</li>
                            <li>셀프서비스 플로우 매칭 (12개)</li>
                            <li>단계별 가이드 자동 생성</li>
                            <li>해당 마켓 도메인 URL 포함</li>
                            <li>"CS 티켓 제출" 옵션 제공</li>
                        </ul>
                        <div class="file-ref">app/services/self_service.py (L3 모드)</div>
                    </div>
                    <div style="text-align: center; margin-top: 8px;">
                        <span style="font-size: 12px; color: #047857; font-weight: 600;">월 ~630건 (38%)</span>
                    </div>
                </div>
            </div>

            <!-- Convergence -->
            <div class="converge-wrapper" style="margin-top: 16px;">
                <div class="merge-bar"></div>
                <div class="arrow-down" style="margin-top: 4px;">
                    <div class="arrow-line" style="height: 16px;"></div>
                    <div class="arrow-head"></div>
                    <div class="arrow-label">모든 경로 수렴</div>
                </div>
            </div>

            <!-- STEP 5: RESPONSE OUTPUT -->
            <div class="node node-blue" style="max-width: 600px;">
                <div class="step-label">Step 5</div>
                <div class="title">응답 출력</div>
                <div class="desc">
                    ChatResponse 반환 &mdash; 응답 텍스트 + 메타데이터
                </div>
                <ul class="output-list" style="max-width: 460px; margin: 8px auto 0;">
                    <li><strong>response</strong> &mdash; 고객에게 표시할 응답 텍스트</li>
                    <li><strong>escalation_level</strong> &mdash; L1 / L2 / L3</li>
                    <li><strong>intent</strong> &mdash; 분류된 카테고리 + Sub-Intent</li>
                    <li><strong>fraud_score</strong> &mdash; Fraud 위험도 점수</li>
                    <li><strong>language</strong> &mdash; 감지된 언어</li>
                    <li><strong>session_id</strong> &mdash; 세션 상태 유지</li>
                    <li><strong>confidence</strong> &mdash; 응답 신뢰도</li>
                </ul>
                <div class="file-ref">app/models/chat.py &rarr; ChatResponse</div>
            </div>

            <div class="arrow-down">
                <div class="arrow-line" style="height: 16px;"></div>
                <div class="arrow-head"></div>
            </div>

            <!-- STEP 6: SESSION UPDATE + FEEDBACK -->
            <div class="node node-gray" style="max-width: 500px;">
                <div class="step-label">Step 6</div>
                <div class="title">세션 업데이트 + 피드백 수집</div>
                <div class="desc">
                    대화 이력 저장, 누적 Fraud 점수 갱신<br>
                    고객 피드백 수집 옵션 (POST /api/chat/feedback)
                </div>
                <div class="file-ref">app/services/session_manager.py + app/routers/chat.py</div>
            </div>

        </div><!-- /flow-center -->
    </div><!-- /flow-section -->


    <!-- ===== SUB-DIAGRAM: FRAUD SCORING ===== -->
    <div class="sub-diagram">
        <div class="sub-diagram-title">Fraud 탐지 상세 &mdash; 9개 Red Flag 지표 + 스코어링</div>

        <div class="fraud-grid">
            <!-- Critical Indicators -->
            <div>
                <div class="fraud-column-title">
                    <span class="fraud-tag fraud-tag-critical">CRITICAL</span>
                    Critical 지표 (5개) &mdash; 단독 에스컬레이션 가능
                </div>
                <div class="fraud-item">
                    <span class="flag-id">C1</span>
                    <span class="flag-name">콘텐츠 열람 후 무단거래 주장</span>
                    <span class="flag-score flag-score-critical">40pt</span>
                </div>
                <div class="fraud-item">
                    <span class="flag-id">C2</span>
                    <span class="flag-name">AI 생성 법률 문서 패턴</span>
                    <span class="flag-score flag-score-critical">35pt</span>
                </div>
                <div class="fraud-item">
                    <span class="flag-id">C3</span>
                    <span class="flag-name">가짜 법률 대리인 사칭</span>
                    <span class="flag-score flag-score-critical">35pt</span>
                </div>
                <div class="fraud-item">
                    <span class="flag-id">C4</span>
                    <span class="flag-name">다중 계정 환불 시도 패턴</span>
                    <span class="flag-score flag-score-critical">30pt</span>
                </div>
                <div class="fraud-item">
                    <span class="flag-id">C5</span>
                    <span class="flag-name">신원 불일치 (이메일/이름 변경)</span>
                    <span class="flag-score flag-score-critical">25pt</span>
                </div>
            </div>

            <!-- Supporting Indicators -->
            <div>
                <div class="fraud-column-title">
                    <span class="fraud-tag fraud-tag-supporting">SUPPORTING</span>
                    Supporting 지표 (4개) &mdash; 2개+ 조합 시 에스컬레이션
                </div>
                <div class="fraud-item">
                    <span class="flag-id">S1</span>
                    <span class="flag-name">긴급성 압박 (즉시, 지금 당장)</span>
                    <span class="flag-score flag-score-supporting">15pt</span>
                </div>
                <div class="fraud-item">
                    <span class="flag-id">S2</span>
                    <span class="flag-name">감정적 조작 (동정 유발)</span>
                    <span class="flag-score flag-score-supporting">15pt</span>
                </div>
                <div class="fraud-item">
                    <span class="flag-id">S3</span>
                    <span class="flag-name">세부사항 모호 (날짜/금액 불일치)</span>
                    <span class="flag-score flag-score-supporting">10pt</span>
                </div>
                <div class="fraud-item">
                    <span class="flag-id">S4</span>
                    <span class="flag-name">반복 패턴 (이전 환불 이력)</span>
                    <span class="flag-score flag-score-supporting">10pt</span>
                </div>
                <div style="margin-top: 16px; padding: 10px; background: rgba(239, 68, 68, 0.08); border: 1px solid rgba(239, 68, 68, 0.15); border-radius: 8px; font-size: 12px; color: #b91c1c;">
                    <strong>에스컬레이션 규칙:</strong><br>
                    &bull; Critical 1개 감지 &rarr; 즉시 L1<br>
                    &bull; Supporting 2개+ 조합 &rarr; L1<br>
                    &bull; 점수 &ge;50 &rarr; 강제 L1
                </div>
            </div>
        </div>

        <!-- Score Bar -->
        <div class="score-bar-container">
            <div class="score-bar-label">Fraud 점수 범위 (0 ~ 100)</div>
            <div class="score-bar">
                <div class="score-segment score-low">
                    LOW (0~29)
                    <span class="score-tick" style="left: 0;">0</span>
                </div>
                <div class="score-segment score-medium">
                    MEDIUM (30~49)
                    <span class="score-tick" style="left: 0;">30</span>
                </div>
                <div class="score-segment score-high">
                    HIGH (50~100) &rarr; L1 에스컬레이션
                    <span class="score-tick" style="left: 0;">50</span>
                    <span class="score-tick" style="right: 0;">100</span>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 12px; color: #64748B; margin-top: 4px; padding: 0 4px;">
                <span>정상 처리</span>
                <span>주의 &mdash; 모니터링</span>
                <span>상담원 즉시 에스컬레이션</span>
            </div>
        </div>
    </div>


    <!-- ===== SUB-DIAGRAM: L3 SELF-SERVICE ===== -->
    <div class="sub-diagram">
        <div class="sub-diagram-title">L3 셀프서비스 대상 &mdash; 12개 Sub-Intent (월 ~630건, 38%)</div>
        <div style="font-size: 12px; color: #64748B; margin-bottom: 12px;">
            아래 Sub-Intent는 <code style="background: rgba(5,150,105,0.12); padding: 2px 6px; border-radius: 4px; color: #047857;">confidence &ge; 0.70</code> 이고 L1/L2 트리거가 없을 때 자동 처리됩니다.
        </div>

        <div class="l3-grid">
            <div class="l3-item">
                <span class="l3-cat l3-cat-sub">SUB</span>
                cancel_subscription
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-sub">SUB</span>
                renewal_date_inquiry
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-sub">SUB</span>
                vip_not_working
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-sub">SUB</span>
                domain_confusion
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-ref">REF</span>
                ios_refund
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-ref">REF</span>
                refund_status
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-acc">ACC</span>
                password_reset
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-acc">ACC</span>
                account_deletion
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-pay">PAY</span>
                payment_method
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-pay">PAY</span>
                payment_failed
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-tech">TECH</span>
                general_tech
            </div>
            <div class="l3-item">
                <span class="l3-cat l3-cat-tech">TECH</span>
                app_issue
            </div>
        </div>

        <div style="margin-top: 16px; display: flex; gap: 12px; flex-wrap: wrap; font-size: 12px; color: #64748B;">
            <span><span class="l3-cat l3-cat-sub" style="font-size: 12px;">SUB</span> = Subscription (구독)</span>
            <span><span class="l3-cat l3-cat-ref" style="font-size: 12px;">REF</span> = Refund (환불)</span>
            <span><span class="l3-cat l3-cat-acc" style="font-size: 12px;">ACC</span> = Account (계정)</span>
            <span><span class="l3-cat l3-cat-pay" style="font-size: 12px;">PAY</span> = Payment (결제)</span>
            <span><span class="l3-cat l3-cat-tech" style="font-size: 12px;">TECH</span> = Technical (기술)</span>
        </div>
    </div>


    <!-- ===== SUB-DIAGRAM: CATEGORY DISTRIBUTION ===== -->
    <div class="sub-diagram">
        <div class="sub-diagram-title">카테고리별 처리 전략 &mdash; 11,621건 실데이터 기반</div>
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.15);">
                        <th style="text-align: left; padding: 10px 8px; color: #64748B; font-weight: 600;">카테고리</th>
                        <th style="text-align: center; padding: 10px 8px; color: #64748B; font-weight: 600;">월평균</th>
                        <th style="text-align: center; padding: 10px 8px; color: #64748B; font-weight: 600;">비중</th>
                        <th style="text-align: center; padding: 10px 8px; color: #64748B; font-weight: 600;">셀프서비스</th>
                        <th style="text-align: center; padding: 10px 8px; color: #64748B; font-weight: 600;">라우팅</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.06);">
                        <td style="padding: 8px; font-weight: 600; color: #1d4ed8;">Subscription</td>
                        <td style="text-align: center; padding: 8px;">700건</td>
                        <td style="text-align: center; padding: 8px;">48%</td>
                        <td style="text-align: center; padding: 8px; color: #047857;">구독 해지 안내 (95%)</td>
                        <td style="text-align: center; padding: 8px;"><span class="decision-result result-l3" style="font-size: 12px;">L3</span> / <span class="decision-result result-l1" style="font-size: 12px;">L1</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.06);">
                        <td style="padding: 8px; font-weight: 600; color: #92400e;">Refund</td>
                        <td style="text-align: center; padding: 8px;">367건</td>
                        <td style="text-align: center; padding: 8px;">25%</td>
                        <td style="text-align: center; padding: 8px; color: #047857;">iOS 환불 안내, 환불 상태</td>
                        <td style="text-align: center; padding: 8px;"><span class="decision-result result-l3" style="font-size: 12px;">L3</span> / <span class="decision-result result-l2" style="font-size: 12px;">L2</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.06);">
                        <td style="padding: 8px; font-weight: 600; color: #6d28d9;">Account</td>
                        <td style="text-align: center; padding: 8px;">189건</td>
                        <td style="text-align: center; padding: 8px;">13%</td>
                        <td style="text-align: center; padding: 8px; color: #047857;">비밀번호 리셋, 계정 삭제</td>
                        <td style="text-align: center; padding: 8px;"><span class="decision-result result-l3" style="font-size: 12px;">L3</span> / <span class="decision-result result-l2" style="font-size: 12px;">L2</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.06);">
                        <td style="padding: 8px; font-weight: 600; color: #a5f3fc;">Payment</td>
                        <td style="text-align: center; padding: 8px;">86건</td>
                        <td style="text-align: center; padding: 8px;">5%</td>
                        <td style="text-align: center; padding: 8px; color: #047857;">결제 방법, 실패 안내</td>
                        <td style="text-align: center; padding: 8px;"><span class="decision-result result-l3" style="font-size: 12px;">L3</span> / <span class="decision-result result-l1" style="font-size: 12px;">L1</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.06);">
                        <td style="padding: 8px; font-weight: 600; color: #b91c1c;">Content</td>
                        <td style="text-align: center; padding: 8px;">57건</td>
                        <td style="text-align: center; padding: 8px;">4%</td>
                        <td style="text-align: center; padding: 8px; color: #b91c1c;">없음 (전체 에스컬레이션)</td>
                        <td style="text-align: center; padding: 8px;"><span class="decision-result result-l1" style="font-size: 12px;">L1</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.06);">
                        <td style="padding: 8px; font-weight: 600; color: #475569;">Technical</td>
                        <td style="text-align: center; padding: 8px;">32건</td>
                        <td style="text-align: center; padding: 8px;">3%</td>
                        <td style="text-align: center; padding: 8px; color: #047857;">캐시 삭제, 앱 업데이트</td>
                        <td style="text-align: center; padding: 8px;"><span class="decision-result result-l3" style="font-size: 12px;">L3</span> / <span class="decision-result result-l1" style="font-size: 12px;">L1</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: 600; color: #b91c1c;">Other</td>
                        <td style="text-align: center; padding: 8px;">30건</td>
                        <td style="text-align: center; padding: 8px;">2%</td>
                        <td style="text-align: center; padding: 8px; color: #b91c1c;">없음 (전체 에스컬레이션)</td>
                        <td style="text-align: center; padding: 8px;"><span class="decision-result result-l1" style="font-size: 12px;">L1</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>


    <!-- ===== SUB-DIAGRAM: SPECIAL RULES ===== -->
    <div class="sub-diagram">
        <div class="sub-diagram-title">자동화 영구 배제 영역 + 특수 규칙</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">

            <div style="padding: 14px; background: rgba(239, 68, 68, 0.06); border: 1px solid rgba(239, 68, 68, 0.15); border-radius: 10px;">
                <div style="font-size: 13px; font-weight: 700; color: #b91c1c; margin-bottom: 8px;">자동화 영구 배제</div>
                <ul class="output-list" style="color: #b91c1c;">
                    <li>Content 카테고리 전체 (작품 관련)</li>
                    <li>Other 카테고리 전체 (비CS 문의)</li>
                    <li>기기+OS 포함 상세 버그 리포트</li>
                    <li>법적/컴플라이언스 문의 (EU, GDPR, CDC)</li>
                    <li>Fraud 의심 건 (Critical 1+ 또는 Supporting 2+)</li>
                </ul>
            </div>

            <div style="padding: 14px; background: rgba(245, 158, 11, 0.06); border: 1px solid rgba(245, 158, 11, 0.15); border-radius: 10px;">
                <div style="font-size: 13px; font-weight: 700; color: #b45309; margin-bottom: 8px;">특수 처리 규칙</div>
                <ul class="output-list" style="color: #92400e;">
                    <li>Minna Technologies 자동 요청 &rarr; 절대 응답 금지</li>
                    <li>(@cancel.us.minnatechnologies.com)</li>
                    <li>차지백 &rarr; 고객 응대 최우선 (L1 강제 아님)</li>
                    <li>Content 최초 감지 &rarr; 상세정보 요청 후 L2</li>
                    <li>결제 카테고리 &rarr; 결제 정보 요청 후 라우팅</li>
                    <li>반복 응답 감지 &rarr; 자동 L2 에스컬레이션</li>
                </ul>
            </div>

        </div>
    </div>


    <!-- ===== LEGEND ===== -->
    <div class="legend">
        <div class="legend-title">범례 (Legend)</div>
        <div class="legend-item">
            <div class="legend-swatch swatch-blue"></div>
            <span>입력/처리 (Input / Processing)</span>
        </div>
        <div class="legend-item">
            <div class="legend-swatch swatch-red"></div>
            <span>L1 경로 (즉시 에스컬레이션)</span>
        </div>
        <div class="legend-item">
            <div class="legend-swatch swatch-orange"></div>
            <span>L2 경로 (AI 초안 + 상담원 검토)</span>
        </div>
        <div class="legend-item">
            <div class="legend-swatch swatch-green"></div>
            <span>L3 경로 (셀프서비스 자동 처리)</span>
        </div>
        <div class="legend-item">
            <div class="legend-swatch swatch-purple"></div>
            <span>Fraud 탐지 (Red Flag 스코어링)</span>
        </div>
        <div class="legend-item">
            <div class="legend-swatch swatch-cyan"></div>
            <span>언어 감지 / 에스컬레이션 판단</span>
        </div>
        <div class="legend-item">
            <div class="legend-diamond swatch-diamond"></div>
            <span>의사결정 분기점 (Decision)</span>
        </div>
        <div class="legend-item" style="width: 100%; margin-top: 4px;">
            <span style="color: #64748B; font-size: 12px;">
                모든 흐름은 app/services/pipeline.py (ChatPipeline.process)에서 오케스트레이션됩니다.
                서버: FastAPI (app/main.py) &mdash; API: POST /api/chat
            </span>
        </div>
    </div>


    <!-- ===== FOOTER ===== -->
    <div class="footer">
        <p>TOOMICS CS AI 챗봇 파이프라인 플로우 다이어그램 &mdash; 작성자: 유종선 &mdash; 2026-02-22</p>
        <p style="margin-top: 4px;">Phase 2 프로토타입 서버 기준 | 데이터: 11,621건 &times; 7개월 &times; 10개 마켓 실제 CS 데이터</p>
    </div>

</div><!-- /container -->

</body>
</html>
